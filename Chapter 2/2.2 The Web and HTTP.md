### 1. Overview of HTTP

* HTTP is the Web’s application-layer protocol.
* HTTP is implemented in two programs: a client program and a server program.
* The client program and server program, executing on different end systems, talk to each other by exchanging HTTP messages.
* Web terminology
	* A Web page (also called a document) consists of objects.
	* An object is simply a file—such as an HTML file, a JPEG image, a Javascrpt file, a CCS style sheet file, or a video clip—that is addressable by a single URL.
	* Most Web pages consist of a base HTML file and several referenced objects.
	* Each URL has two components: the hostname of the server that houses the object and the object’s path name.
	* Web browsers (such as Firefox, Edge, Chrome) implement the client side of HTTP. Hence in the context of the Web, the words browser and client are used interchangeably.
	* Web servers (such as Apache and Microsoft Internet Information Server) implement the server side of HTTP and house Web objects - each addressable by a URL.
* HTTP defines how Web clients/browsers request Web pages from Web servers and how servers transfer Web pages to clients.
* The Web uses the client-server application architecture - A Web server is always on, with a fixed IP address, and it services requests from potentially millions of different browsers.
* HTTP uses TCP as its underlying transport protocol.
	* The HTTP client first initiates a TCP connection with the server.
 	* Once the connection is established, the browser and the server processes access TCP through their socket interfaces.
  	* TCP provides reliable data transfer service to HTTP - each HTTP request message sent by a client process eventually arrives intact at the server; similarly, each HTTP response message sent by the server process eventually arrives intact at the client.
* The server sends requested files to clients without storing any state information about the client.
* As an HTTP server maintains no information about the clients, HTTP is said to be a stateless protocol.

***

### 2. Non-Persistent and Persistent Connections

* When this client-server interaction is taking place over TCP, the application developer needs to make an important decision—should each request/response pair be sent over a separate TCP connection, or should all of the requests and their corresponding responses be sent over the same TCP connection?
* The application is using non-persistent connections in the former approach and persistent connections in the latter approach.
* HTTP uses persistent connections in its default mode, however HTTP clients and servers can be configured to use non-persistent connections instead.

###### HTTP with Non-Persistent Connections
* In case of non-persistant connections, the seperate TCP connection is used for every request/response interaction between the client and the server.
* Hence, if a client requests for a web page with 1 base HTML file and 10 images, then a total of 11 TCP connections will be used as each non-persistent TCP connection transports exactly one request message and one response message.
* HTTP/1.0 employes non-persistent TCP connections.
* Users can configure some browsers to control the degree of parallelism.
	* Browsers may open multiple TCP connections and request different parts of the Web page over the multiple connections.
 	* This helps reduce the response time
* Assuming RTT represents the Round Trip Time for one packet to go from the client to the server and back to the client, then for each TCP connection, the following delays are involved:
	* Three-way TCP handshake - the client sends a small TCP segment to the server, the server acknowledges and responds with a small TCP segment, and, finally, the client acknowledges back to the server.
 	* The first two parts take up one RTT.
  	* The client sends the HTTP request message with its ACK in the second RTT.
  	* The server then sends the HTML file into the TCP connection.
  	* This takes up another RTT plus transmission time for the server to send the entire file.
	* Therefore, the total response time is roughly two RTTs plus the transmission time at the server.

###### HTTP with Persistent Connections
* Non-persistent connections have some shortcomings:
	* A brand-new TCP connection must be established and maintained for each requested object.
 	* For each of these connections, TCP buffers must be allocated and TCP variables must be kept in both the client and server, leading to increased overheads.
  	* Each object suffers a delivery delay of two RTTs—one RTT to establish the TCP connection and one RTT to request and receive an object.
* With HTTP/1.1 persistent connections, the server leaves the TCP connection open after sending a response.
* Hence, subsequent requests and responses between the same client and server can be sent over the same connection.
* Therefore, the entire web page with 1 base HTML file and 10 images can be sent over a single persistent TCP connection.
* Moreover, multiple Web pages residing on the same server can be sent from the server to the same client over a single persistent TCP connection.
* These requests for objects can be made back-to-back, without waiting for replies to pending requests (pipelining).
	* When the server receives the back-to-back requests, it sends the objects back-to-back.
	* The default mode of HTTP uses persistent connections with pipelining.
* Typically, the HTTP server closes a connection when it isn’t used for a certain time (a configurable timeout interval).

*** 

### 3. HTTP Message Format

###### HTTP Request Message
* Below we provide a typical HTTP request message:
```
GET /somedir/page.html HTTP/1.1
Host: www.someschool.edu
Connection: close
User-agent: Mozilla/5.0
Accept-language: fr
```
* The first line of an HTTP request message is called the request line.
	* The request line has three fields: the method field (`GET`), the URL field (`/somedir/page.html`), and the HTTP version field (`HTTP/1.1`).
 	* The method field can take on several different values, including `GET`, `POST`, `HEAD`, `PUT`, and `DELETE`.
* The subsequent lines are called the header lines
	* The header line `Host: www.someschool.edu` specifies the host on which the object resides.
	* By including the `Connection: close` header line, the browser is telling the server that it wants the server to close the connection after sending the requested object (hence it's a non-persistent connection).
	* The `User-agent: Mozilla/5.0` header line specifies the user agent - the browser type that is making the request to the server.
	* This header line is useful because the server can actually send different versions of the same object to different types of user agents.
	* Finally, the `Accept-language: fr` header indicates that the user prefers to receive a French version of the object (if available, else the default version).
* Some HTTP messages also have entity body after the header lines
	* An HTTP client often uses the `POST` method when the user fills out a form (for example, when a user provides search words to a search engine).
 	* With a `POST` message, the user is still requesting a Web page from the server, but the specific contents of the Web page depend on what the user entered into the form fields.
  	* If the value of the method field is `POST`, then the entity body contains what the user entered into the form fields.
  	* A request generated with a form does not necessarily have to use the `POST` method. Instead, HTML forms often use the `GET` method and include the inputted data (in the form fields) in the requested URL (in the format of `URL?Input1&Input2`).
* Other HTTP Request methods
	* When a server receives a request with the `HEAD` method, it responds with an HTTP message but it leaves out the requested object, making it useful for debugging.
 	* The `PUT` method allows a user to upload an object to a specific path (directory) on a specific Web server (often used with Web publishing tools).
  	* The `PUT` method is also used by applications that need to upload objects to Web servers.
  	* The `DELETE` method allows a user, or an application, to delete an object on a Web server.

###### HTTP Response Message
* Below is a typical HTTP response message:
```
HTTP/1.1 200 OK
Connection: close
Date: Tue, 18 Aug 2015 15:44:04 GMT
Server: Apache/2.2.3 (CentOS)
Last-Modified: Tue, 18 Aug 2015 15:11:03 GMT
Content-Length: 6821
Content-Type: text/html
(data data data data data ...)
```
* The first line in the HTTP response message is a status line:
	* It three fields: the protocol version (`HTTP/1.1`), a status code (`200`), and a corresponding status message(`OK`).
 	* Following are a few common status codes and associated phrases:
  		* `200 OK` - Request succeeded and the information is returned in the response
		* `301 Moved Permanently` - Requested object has been permanently moved; the new URL is specified in `Location: NEW_URL` header of the response message. The client software will automatically retrieve the new URL.
    	* `400 Bad Request` - This is a generic error code indicating that the request could not be understood by the server.
     	* `404 Not Found` - The requested document does not exist on this server.
      	* `505 HTTP Version Not Supported` - The requested HTTP protocol version is not supported by the server.
* The next few lines are header lines:
	* The `Connection: close` header line indicates that the server is going to close the TCP connection after sending the message.
 	* The `Date:` header line indicates the time and date when the HTTP response was created and sent by the server.
  	* The `Last-Modified:` header line indicates the time and date when the object was created or last modified. It is critical for object caching, both in the local client and in network cache servers (also known as proxy servers).
  	* The `Server: Apache/2.2.3 (CentOS)` header line indicates that the message was generated by an Apache Web server; it is analogous to the `User-agent:` header line in the HTTP request message.
  	* The `Content-Length:` header line indicates the number of bytes in the object being sent.
  	* The `Content-Type: text/html` header line indicates that the object in the entity body is HTML text.
* After the headers is the entity body, which contains the requested object (in that case, the HTML file).

Refer to [Additional texts](https://github.com/violet-autumn/Computer-Networking/blob/main/Chapter%202/Additional%20texts.md#http-request-and-response-texts) to check out actual HTTP Request and Response headers. 

***

### 4. User-Server Interaction: Cookies
