
###### Internet Mail System

* The Internet mail system has three major components: user agents, mail servers, and the Simple Mail Transfer Protocol (SMTP).
* User agents (Gmail, Outlook, Apple Mail, etc) allow users to read, reply to, forward, save, and compose messages.
* Journey of mail: Sender's user agent -> Sender's mail server (outgoing queue) -> Recipient's mail server (mailbox) -> Recipient's user agent
* When the recipient wants to access the messages in their mailbox, their mail server authenticates the recipient and then their user agent retrieves the mails from the mailbox.
* The sender's mail server also deals with failures in reciever's mail server, in which case the mail remains in the message queue of the sender and re-attempts delivery. 
* SMTP is the principal application-layer protocol for Internet electronic mail.
	* It uses the reliable data transfer service of TCP to transfer mail from the sender’s mail server to the recipient’s mail server.
 	* As with most application-layer protocols, SMTP has two sides: a client side, which executes on the sender’s mail server, and a server side, which executes on the recipient’s mail server.
  	* Both the client and server sides of SMTP run on every mail server.
  	* When a mail server sends mail to other mail servers, it acts as an SMTP client.
  	* When a mail server receives mail from other mail servers, it acts as an SMTP server.

***

### 1. SMTP

* SMTP transfers messages from senders’ mail servers to the recipients’ mail servers.
* Following illustrates the basic operation of SMTP (Alice is sending a mail to Bob):
	* Alice invokes her user agent for e-mail, provides Bob’s e-mail address, composes a message, and instructs the user agent to send the message.
 	* Alice’s user agent sends the message to her mail server, where it is placed in a message queue.
  	* The client side of SMTP, running on Alice’s mail server, sees the message in the message queue, and opens a TCP connection to an SMTP server running on Bob’s mail server.
  	* If the receiever's mail server is down, the client server tries again later.
  	* After some initial SMTP handshaking, the SMTP client sends Alice’s message into the TCP connection.
  	* At Bob’s mail server, the server side of SMTP receives the message.
  	* Bob’s mail server then places the message in Bob’s mailbox.
  	* Bob invokes his user agent to read the message at his convenience.
* SMTP does not normally use intermediate mail servers for sending mail, even if the two mail server are at the opposite ends of the world.
* SMTP uses persistent connections: If the sending mail server has several messages to send to the same receiving mail server, it can send all of the messages over the same TCP connection.
* 
